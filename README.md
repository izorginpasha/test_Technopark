# test_Technopark
ответ на задание 
REST-сервис, который:
1. Получает параметры расчёта изделия
2. Вызывает функцию расчёта (локальную)
3. Сохраняет результат в базу (Postgres )
4. Возвращает вычисленное значение клиенту


1 структура 

src/
  main.py               # Точка входа FastAPI-приложения

  api/
    __init__.py
    calc.py             # Маршруты /calc 

  schemas/
    __init__.py
    calc.py             # Pydantic-схемы запросов/ответов

  db/
    __init__.py
    config.py           # Чтение конфигурации (env), формирование DATABASE_URL
    session.py          # Создание async engine и сессий
    models.py           # SQLAlchemy-модели (в т.ч. результат расчёта)

  crud/
    __init__.py
    calc.py             # Операции с БД: создать/получить 

  services/
    __init__.py
    calc_service.py     # Бизнес-логика: расчёт стоимости, вызов CRUD
  
2 Бизнес-логика (как считать стоимость, какие поля учитывать, в каком формате хранить результат) должна находиться в слое services/.
а все запросы к бд в crud так как в бизнес логике ведутся расчеты а запросы к  бд лучше вынести
3 Для загрузки конфигурации используется pydantic-settings .
4 Ошибки валидации: стандартный модуль logging при необходимости — структурированное логирование (JSON) через logging/structlog.
  Ошибки БД: операции оборачиваются в try/except для SQLAlchemyError / ошибок драйвера.
  На уровне приложения: регистрируется глобальный exception_handler для БД-исключений,
  в ответ клиенту возвращается 500 Internal Server Error или 503 с сообщением вида:
  "detail": "Database error" без технических подробностей.

Вопрос №2. Таблица расчётов коммерческих предложений
1. Почему здесь есть проблема со стоимостью?
2. Как привести unit к единой системе?
3. Куда в архитектуре должен быть вынесен мэппинг единиц измерения — в код, БД, отдельную витрину?
4. Как убедиться, что новые данные не сломают консистентность?
 
1 единицы измерения разные (kg и ton),
значения unit_cost несопоставимы,
при  аналитике такие данные дают некорректные результаты.
2 Решение — нормализовать данные к базовой единице.
3 сделать справочник единиц в БД(таблица units )
4 валидация полеи пред записью по таблице справочнику из бд

3. Практическое задание: Сделать маленький сервис расчёта стоимости изделия
  Ссылка на репозиторий https://github.com/izorginpasha/test_Technopark
  Клонировать репозиторий: git clone https://github.com/username/calc-service.git
  Собрать и запустить проект: docker-compose up --build
  FastAPI-приложение будет доступно на http://localhost:8000
  Swagger UI — http://localhost:8000/docs
  Пример вызова /calc 
  curl -X POST "http://localhost:8000/calc" \
  -H "Content-Type: application/json" \
  -d '{
    "materials": [
      {"name": "steel", "qty": 120, "price_rub": 54.5},
      {"name": "copper", "qty": 12.3, "price_rub": 640.0}
    ]
  }'
 httpie: http POST http://localhost:8000/calc materials:='[
  {"name": "steel", "qty": 120, "price_rub": 54.5},
  {"name": "copper", "qty": 12.3, "price_rub": 640.0}
]'
  При первом запуске сервис автоматически создаёт таблицу calc_results в базе данных Postgres.
Логи приложения и SQL-запросов выводятся в консоль.

III. Написать один SQL-запрос, который возвращает 10 последних расчётов отсортированных по дате
SELECT id, total_cost_rub, created_at
FROM calc_results
ORDER BY created_at DESC
LIMIT 10;