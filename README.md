# test_Technopark

–û—Ç–≤–µ—Ç –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ  

---

## REST-—Å–µ—Ä–≤–∏—Å

–°–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π:
1. –ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á—ë—Ç–∞ –∏–∑–¥–µ–ª–∏—è  
2. –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å—á—ë—Ç–∞ (–ª–æ–∫–∞–ª—å–Ω—É—é)  
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–∞–∑—É (Postgres)  
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É  

---

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
src/
  main.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

  api/
    __init__.py
    calc.py             # –ú–∞—Ä—à—Ä—É—Ç—ã /calc 

  schemas/
    __init__.py
    calc.py             # Pydantic-—Å—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

  db/
    __init__.py
    config.py           # –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (env), —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ DATABASE_URL
    session.py          # –°–æ–∑–¥–∞–Ω–∏–µ async engine –∏ —Å–µ—Å—Å–∏–π
    models.py           # SQLAlchemy-–º–æ–¥–µ–ª–∏ (–≤ —Ç.—á. —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞)

  crud/
    __init__.py
    calc.py             # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î: —Å–æ–∑–¥–∞—Ç—å/–ø–æ–ª—É—á–∏—Ç—å 

  services/
    __init__.py
    calc_service.py     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –≤—ã–∑–æ–≤ CRUD
```

2. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**  
–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∫–∞–∫–∏–µ –ø–æ–ª—è —É—á–∏—Ç—ã–≤–∞—Ç—å, –≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç) –¥–æ–ª–∂–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Å–ª–æ–µ `services/`.  
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `crud`, —Ç–∞–∫ –∫–∞–∫ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–∞—Å—á—ë—Ç—ã, –∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–ª–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env)**  
–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pydantic-settings`.  
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env`.

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**  
**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–æ–¥—É–ª—å `logging`;
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (JSON) —á–µ—Ä–µ–∑ `logging` / `structlog`.

**–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
- –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º FastAPI / Pydantic;
- –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `422 Unprocessable Entity`.

**–û—à–∏–±–∫–∏ –ë–î:**
- –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ `try/except` –¥–ª—è `SQLAlchemyError` / –æ—à–∏–±–æ–∫ –¥—Ä–∞–π–≤–µ—Ä–∞;
- –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è `exception_handler` –¥–ª—è –ë–î-–∏—Å–∫–ª—é—á–µ–Ω–∏–π;
- –∫–ª–∏–µ–Ω—Ç—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `500 Internal Server Error` –∏–ª–∏ `503 Service Unavailable` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º  
  `"detail": "Database error"` –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

---

## –í–æ–ø—Ä–æ—Å ‚Ññ2. –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—á—ë—Ç–æ–≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

1. **–ü–æ—á–µ–º—É –∑–¥–µ—Å—å –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é?**  
   –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–∞–∑–Ω—ã–µ (`kg` –∏ `ton`), –∑–Ω–∞—á–µ–Ω–∏—è `unit_cost` –Ω–µ—Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã,  
   –ø—Ä–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ —Ç–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–∞—é—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

2. **–ö–∞–∫ –ø—Ä–∏–≤–µ—Å—Ç–∏ `unit` –∫ –µ–¥–∏–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ?**  
   –†–µ—à–µ–Ω–∏–µ ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫ –±–∞–∑–æ–≤–æ–π –µ–¥–∏–Ω–∏—Ü–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `kg`).  
   –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–µ ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –±–∞–∑–æ–≤—É—é –µ–¥–∏–Ω–∏—Ü—É.

3. **–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –º—ç–ø–ø–∏–Ω–≥ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è?**  
   –°–¥–µ–ª–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –µ–¥–∏–Ω–∏—Ü –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ `units`):

   ```text
   code | to_base_factor | dimension
   kg   | 1              | mass
   ton  | 1000           | mass
   ```
   –ú—ç–ø–ø–∏–Ω–≥ –µ–¥–∏–Ω–∏—Ü –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ë–î, –∞ –Ω–µ –≤ –∫–æ–¥–µ.

4. **–ö–∞–∫ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–ª–æ–º–∞—é—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å?**  
   –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –ø–æ —Ç–∞–±–ª–∏—Ü–µ-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫—É –∏–∑ –ë–î.  
   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `unit` –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–æ–º.   
   –ï–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π.

---

## 3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

–ú–∞–ª–µ–Ω—å–∫–∏–π —Å–µ—Ä–≤–∏—Å —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏–∑–¥–µ–ª–∏—è

**–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**  
üëâ [https://github.com/izorginpasha/test_Technopark](https://github.com/izorginpasha/test_Technopark)

**–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone https://github.com/izorginpasha/test_Technopark.git
cd test_Technopark
```

**–°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç:**
```bash
docker-compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
- FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `http://localhost:8000`
- Swagger UI ‚Äî `http://localhost:8000/docs`

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `calc_results` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Postgres.  
–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.

---

### –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ /calc

**cURL:**
```bash
curl -X POST "http://localhost:8000/calc"   -H "Content-Type: application/json"   -d '{
    "materials": [
      {"name": "steel", "qty": 120, "price_rub": 54.5},
      {"name": "copper", "qty": 12.3, "price_rub": 640.0}
    ]
  }'
```

**httpie:**
```bash
http POST http://localhost:8000/calc materials:='[
  {"name": "steel", "qty": 120, "price_rub": 54.5},
  {"name": "copper", "qty": 12.3, "price_rub": 640.0}
]'
```

---

## SQL-–∑–∞–ø—Ä–æ—Å

–û–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–µ:

```sql
SELECT id, total_cost_rub, created_at
FROM calc_results
ORDER BY created_at DESC
LIMIT 10;
```
